import{r as i,t as Hs,c as Ks,j as e,V as Ye,R as Ze,A as We,C as Xe,X as Fe,T as Ge,D as es,a as fe,P as Qs,b as Js,$ as Ys,d as ss,e as Zs,f as Ws,S as Xs,g as Gs,h as et,u as De,i as Pe,k as ge,O as ts,l as as,m as st,n as rs,o as ns,p as tt,q as at,s as rt,v as is,w as os,G as Se,x as Ce,L as nt,B as He,U as Z,y as W,z as Te,E as Ke,F as be,H as it,I as ls,J as ot,K as pe,M as X,N as je,Q as lt,W as ct,Y as Qe,Z as he,_ as Re,a0 as dt,a1 as mt,a2 as cs,a3 as ds,a4 as ms,a5 as us,a6 as xs,a7 as hs,a8 as ut,a9 as xt,aa as ht,ab as ft,ac as gt,ad as pt,ae as jt,af as fs,ag as gs,ah as ps,ai as vt,aj as Nt,ak as bt,al as yt,am as wt,an as St,ao as Ct,ap as se,aq as Tt}from"./vendor-CqO_TLtr.js";import"./ui-DW48STyt.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const kt=1,At=1e6;let ye=0;function Et(){return ye=(ye+1)%Number.MAX_SAFE_INTEGER,ye.toString()}const we=new Map,Je=s=>{if(we.has(s))return;const t=setTimeout(()=>{we.delete(s),ce({type:"REMOVE_TOAST",toastId:s})},At);we.set(s,t)},Ft=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,kt)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?Je(a):s.toasts.forEach(r=>{Je(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},ue=[];let xe={toasts:[]};function ce(s){xe=Ft(xe,s),ue.forEach(t=>{t(xe)})}function Dt({...s}){const t=Et(),a=n=>ce({type:"UPDATE_TOAST",toast:{...n,id:t}}),r=()=>ce({type:"DISMISS_TOAST",toastId:t});return ce({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:n=>{n||r()}}}),{id:t,dismiss:r,update:a}}function H(){const[s,t]=i.useState(xe);return i.useEffect(()=>(ue.push(t),()=>{const a=ue.indexOf(t);a>-1&&ue.splice(a,1)}),[s]),{...s,toast:Dt,dismiss:a=>ce({type:"DISMISS_TOAST",toastId:a})}}function j(...s){return Hs(Ks(s))}const Pt=Qs,js=i.forwardRef(({className:s,...t},a)=>e.jsx(Ye,{ref:a,className:j("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));js.displayName=Ye.displayName;const Rt=fe("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),vs=i.forwardRef(({className:s,variant:t,...a},r)=>e.jsx(Ze,{ref:r,className:j(Rt({variant:t}),s),...a}));vs.displayName=Ze.displayName;const It=i.forwardRef(({className:s,...t},a)=>e.jsx(We,{ref:a,className:j("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",s),...t}));It.displayName=We.displayName;const Ns=i.forwardRef(({className:s,...t},a)=>e.jsx(Xe,{ref:a,className:j("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Fe,{className:"h-4 w-4"})}));Ns.displayName=Xe.displayName;const bs=i.forwardRef(({className:s,...t},a)=>e.jsx(Ge,{ref:a,className:j("text-sm font-semibold",s),...t}));bs.displayName=Ge.displayName;const ys=i.forwardRef(({className:s,...t},a)=>e.jsx(es,{ref:a,className:j("text-sm opacity-90",s),...t}));ys.displayName=es.displayName;function Mt(){const{toasts:s}=H();return e.jsxs(Pt,{children:[s.map(function({id:t,title:a,description:r,action:n,...o}){return e.jsxs(vs,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(bs,{children:a}),r&&e.jsx(ys,{children:r})]}),n,e.jsx(Ns,{})]},t)}),e.jsx(js,{})]})}const zt=({...s})=>{const{theme:t="system"}=Js();return e.jsx(Ys,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},$t=Zs,_t=i.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(ss,{ref:r,sideOffset:t,className:j("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));_t.displayName=ss.displayName;const Ot="https://bggmbauttgxqfdfokfet.supabase.co",Lt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJnZ21iYXV0dGd4cWZkZm9rZmV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczOTkyMzEsImV4cCI6MjA3Mjk3NTIzMX0.KkM5-23lfcvsm3HlOVveZgmTblfsP2qoRNbBxOxUTdA",A=Ws(Ot,Lt,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),ws=i.createContext(void 0),Ie=()=>{const s=i.useContext(ws);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},qt=({children:s})=>{const[t,a]=i.useState(null),[r,n]=i.useState(null),[o,l]=i.useState(!0);i.useEffect(()=>{const{data:{subscription:v}}=A.auth.onAuthStateChange((h,p)=>{n(p),a((p==null?void 0:p.user)??null),l(!1)});return A.auth.getSession().then(({data:{session:h}})=>{n(h),a((h==null?void 0:h.user)??null),l(!1)}),()=>v.unsubscribe()},[]);const f={user:t,session:r,loading:o,signUp:async(v,h,p)=>{const N=`${window.location.origin}/`,{error:C}=await A.auth.signUp({email:v,password:h,options:{emailRedirectTo:N,data:{full_name:p}}});return{error:C}},signIn:async(v,h)=>{const{error:p}=await A.auth.signInWithPassword({email:v,password:h});return{error:p}},signOut:async()=>{await A.auth.signOut()}};return e.jsx(ws.Provider,{value:f,children:s})},Me=fe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",camera:"bg-gradient-primary text-primary-foreground hover:bg-primary-hover shadow-medium hover:shadow-strong transition-all duration-200",success:"bg-gradient-success text-success-foreground hover:bg-success/90 shadow-medium hover:shadow-strong transition-all duration-200"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=i.forwardRef(({className:s,variant:t,size:a,asChild:r=!1,...n},o)=>{const l=r?Xs:"button";return e.jsx(l,{className:j(Me({variant:t,size:a,className:s})),ref:o,...n})});m.displayName="Button";const y=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:j("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t}));y.displayName="Card";const R=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:j("flex flex-col space-y-1.5 p-6",s),...t}));R.displayName="CardHeader";const I=i.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:j("text-2xl font-semibold leading-none tracking-tight",s),...t}));I.displayName="CardTitle";const ze=i.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:j("text-sm text-muted-foreground",s),...t}));ze.displayName="CardDescription";const w=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:j("p-6 pt-0",s),...t}));w.displayName="CardContent";const Ut=i.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:j("flex items-center p-6 pt-0",s),...t}));Ut.displayName="CardFooter";const Bt=()=>{const[s,t]=i.useState(null),[a,r]=i.useState(!1),[n,o]=i.useState(!1),[l,x]=i.useState(!1);i.useEffect(()=>{const f=window.matchMedia("(display-mode: standalone)").matches;x(f);const v=/iPad|iPhone|iPod/.test(navigator.userAgent);o(v);const h=p=>{p.preventDefault(),t(p),r(!0)};return window.addEventListener("beforeinstallprompt",h),v&&!f&&setTimeout(()=>{r(!0)},3e3),()=>{window.removeEventListener("beforeinstallprompt",h)}},[]);const g=async()=>{if(s){s.prompt();const{outcome:f}=await s.userChoice;console.log(`User response to the install prompt: ${f}`),t(null),r(!1)}},u=()=>{r(!1),sessionStorage.setItem("installPromptDismissed","true")};return l||!a||sessionStorage.getItem("installPromptDismissed")?null:e.jsx(y,{className:"fixed bottom-4 left-4 right-4 z-50 p-4 bg-primary text-primary-foreground shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Gs,{className:"w-6 h-6 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1",children:"Install FaceAttend App"}),e.jsx("p",{className:"text-xs text-primary-foreground/90 mb-3",children:n?"Add to Home Screen for the best experience. Tap the share button and select 'Add to Home Screen'.":"Install FaceAttend for faster access and better camera performance."}),e.jsxs("div",{className:"flex gap-2",children:[!n&&e.jsxs(m,{size:"sm",variant:"secondary",onClick:g,className:"text-xs",children:[e.jsx(et,{className:"w-3 h-3 mr-1"}),"Install"]}),e.jsx(m,{size:"sm",variant:"ghost",onClick:u,className:"text-xs text-primary-foreground hover:bg-primary-foreground/10",children:"Maybe Later"})]})]}),e.jsx(m,{size:"sm",variant:"ghost",onClick:u,className:"flex-shrink-0 text-primary-foreground hover:bg-primary-foreground/10",children:e.jsx(Fe,{className:"w-4 h-4"})})]})})},Vt=()=>De({queryKey:["classes"],queryFn:async()=>{const{data:s,error:t}=await A.from("classes").select("*").order("created_at",{ascending:!1});if(t)throw t;return s}}),Ss=s=>De({queryKey:["class",s],queryFn:async()=>{const{data:t,error:a}=await A.from("classes").select("*").eq("id",s).single();if(a)throw a;return t},enabled:!!s}),Cs=s=>De({queryKey:["enrollments",s],queryFn:async()=>{const{data:t,error:a}=await A.from("enrollments").select(`
          *,
          students (*)
        `).eq("class_id",s).order("enrolled_at",{ascending:!1});if(a)throw a;return t},enabled:!!s}),Ht=()=>{const s=Pe(),{toast:t}=H();return ge({mutationFn:async a=>{const{data:{user:r}}=await A.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:n,error:o}=await A.from("classes").insert({...a,teacher_id:r.id}).select().single();if(o)throw o;return n},onSuccess:()=>{s.invalidateQueries({queryKey:["classes"]}),t({title:"Success",description:"Class created successfully"})},onError:a=>{t({title:"Error",description:a.message,variant:"destructive"})}})},Kt=()=>{const{toast:s}=H();return ge({mutationFn:async t=>{const{data:a,error:r}=await A.from("students").insert(t).select().single();if(r)throw r;return a},onError:t=>{s({title:"Error",description:t.message,variant:"destructive"})}})},Qt=()=>{const s=Pe(),{toast:t}=H();return ge({mutationFn:async({classId:a,studentId:r})=>{const{data:n,error:o}=await A.from("enrollments").insert({class_id:a,student_id:r}).select().single();if(o)throw o;return n},onSuccess:(a,r)=>{s.invalidateQueries({queryKey:["enrollments",r.classId]}),t({title:"Success",description:"Student enrolled successfully"})},onError:a=>{t({title:"Error",description:a.message,variant:"destructive"})}})},Jt=()=>{const s=Pe(),{toast:t}=H();return ge({mutationFn:async({studentId:a,classId:r})=>{const{error:n}=await A.from("enrollments").delete().eq("student_id",a).eq("class_id",r);if(n)throw n;const{error:o}=await A.from("students").delete().eq("id",a);if(o)throw o},onSuccess:(a,r)=>{s.invalidateQueries({queryKey:["enrollments",r.classId]}),s.invalidateQueries({queryKey:["students"]}),t({title:"Success",description:"Student deleted successfully"})},onError:a=>{t({title:"Error",description:a.message,variant:"destructive"})}})},Ts=at,Yt=rt,Zt=tt,ks=i.forwardRef(({className:s,...t},a)=>e.jsx(ts,{ref:a,className:j("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));ks.displayName=ts.displayName;const $e=i.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Zt,{children:[e.jsx(ks,{}),e.jsxs(as,{ref:r,className:j("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(st,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));$e.displayName=as.displayName;const _e=({className:s,...t})=>e.jsx("div",{className:j("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});_e.displayName="DialogHeader";const Oe=i.forwardRef(({className:s,...t},a)=>e.jsx(rs,{ref:a,className:j("text-lg font-semibold leading-none tracking-tight",s),...t}));Oe.displayName=rs.displayName;const Le=i.forwardRef(({className:s,...t},a)=>e.jsx(ns,{ref:a,className:j("text-sm text-muted-foreground",s),...t}));Le.displayName=ns.displayName;const L=i.forwardRef(({className:s,type:t,...a},r)=>e.jsx("input",{type:t,className:j("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a}));L.displayName="Input";const Wt=fe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),q=i.forwardRef(({className:s,...t},a)=>e.jsx(is,{ref:a,className:j(Wt(),s),...t}));q.displayName=is.displayName;const Xt=()=>{const{user:s,loading:t,signOut:a}=Ie(),r=os(),{data:n,isLoading:o}=Vt(),l=Ht(),{toast:x}=H(),[g,u]=i.useState(!1),[f,v]=i.useState({name:"",subject:"",period:""});i.useEffect(()=>{!t&&!s&&r("/auth")},[s,t,r]);const h=async()=>{await a(),x({title:"Signed out",description:"You have been signed out successfully"})},p=async N=>{if(N.preventDefault(),!f.name||!f.subject){x({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}l.mutate(f,{onSuccess:()=>{u(!1),v({name:"",subject:"",period:""})}})};return t||o?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-gradient-subtle",children:[e.jsx("header",{className:"bg-card/95 backdrop-blur-sm border-b shadow-soft sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"FaceAttend"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Welcome back, Teacher"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:h,children:e.jsx(nt,{className:"w-4 h-4"})})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(y,{className:"bg-card/50 backdrop-blur-sm",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx(He,{className:"w-6 h-6 text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:(n==null?void 0:n.length)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Classes"})]})}),e.jsx(y,{className:"bg-card/50 backdrop-blur-sm",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx(Z,{className:"w-6 h-6 text-accent mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:"0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Students"})]})}),e.jsx(y,{className:"bg-card/50 backdrop-blur-sm",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx(W,{className:"w-6 h-6 text-success-soft mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:"0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scans Today"})]})}),e.jsx(y,{className:"bg-card/50 backdrop-blur-sm",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx(Te,{className:"w-6 h-6 text-warning-soft mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:"95%"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Attendance"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Your Classes"}),e.jsxs(Ts,{open:g,onOpenChange:u,children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(m,{className:"gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"New Class"]})}),e.jsxs($e,{children:[e.jsxs(_e,{children:[e.jsx(Oe,{children:"Create New Class"}),e.jsx(Le,{children:"Set up a new class for attendance tracking"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"class-name",children:"Class Name *"}),e.jsx(L,{id:"class-name",placeholder:"e.g., Math 101",value:f.name,onChange:N=>v({...f,name:N.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"subject",children:"Subject *"}),e.jsx(L,{id:"subject",placeholder:"e.g., Mathematics",value:f.subject,onChange:N=>v({...f,subject:N.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"period",children:"Period/Time"}),e.jsx(L,{id:"period",placeholder:"e.g., 1st Period, 9:00 AM",value:f.period,onChange:N=>v({...f,period:N.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Cancel"}),e.jsx(m,{type:"submit",className:"flex-1",disabled:l.isPending,children:l.isPending?"Creating...":"Create Class"})]})]})]})]})]}),(n==null?void 0:n.length)===0?e.jsxs(y,{className:"p-8 text-center bg-card/50 backdrop-blur-sm",children:[e.jsx(Se,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Classes Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first class to start taking attendance"}),e.jsxs(m,{onClick:()=>u(!0),className:"gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Create First Class"]})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:n==null?void 0:n.map(N=>e.jsxs(y,{className:"bg-card/50 backdrop-blur-sm hover:shadow-elegant transition-all",children:[e.jsxs(R,{children:[e.jsxs(I,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:N.name}),e.jsx(He,{className:"w-5 h-5 text-primary flex-shrink-0"})]}),e.jsxs(ze,{children:[N.subject," ",N.period&&`‚Ä¢ ${N.period}`]})]}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"0 students"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"No scans"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{onClick:()=>r(`/scan/${N.id}`),className:"flex-1 gap-2",size:"sm",children:[e.jsx(W,{className:"w-4 h-4"}),"Take Attendance"]}),e.jsxs(m,{onClick:()=>r(`/class/${N.id}`),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Manage"]})]})]})]},N.id))})]})]}):null},Gt=fe("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function G({className:s,variant:t,...a}){return e.jsx("div",{className:j(Gt({variant:t}),s),...a})}let ke=!1,re=null;async function ne(){if(ke)return;if(re)return re;const s="/models";return re=(async()=>{try{console.log("Loading face models from:",s),await Promise.all([be.tinyFaceDetector.loadFromUri(s).catch(t=>{throw console.error("Error loading tinyFaceDetector:",t),t}),be.faceLandmark68Net.loadFromUri(s).catch(t=>{throw console.error("Error loading faceLandmark68Net:",t),t}),be.faceRecognitionNet.loadFromUri(s).catch(t=>{throw console.error("Error loading faceRecognitionNet:",t),t})]),ke=!0,console.log("Face models loaded successfully")}catch(t){throw console.error("Failed to load face models:",t),re=null,new Error("Failed to load face recognition models. Please check if model files are available.")}})(),re}function As(){!ke&&!re&&ne().catch(console.error)}async function ea(s){try{if(await ne(),console.log("Starting face detection..."),!s)return console.log("‚ùå No input element provided"),null;s instanceof HTMLVideoElement&&s.readyState<2&&(console.log("‚ùå Video not ready, waiting..."),await new Promise(l=>{s.addEventListener("loadeddata",l,{once:!0}),setTimeout(l,3e3)})),console.log("üéØ Attempting face detection...");const t=ot(s,new ls({inputSize:224,scoreThreshold:.5})).withFaceLandmarks().withFaceDescriptor(),a=new Promise((l,x)=>setTimeout(()=>x(new Error("Face detection timeout")),5e3)),r=await Promise.race([t,a]);if(!(r!=null&&r.descriptor))return console.log("‚ùå No face detected or no descriptor available"),null;console.log("‚úÖ Face detected successfully!");const n=r.descriptor;if(console.log("üìä Raw descriptor length:",n.length),console.log("üìä Raw descriptor sample:",Array.from(n).slice(0,5)),Array.from(n).some(l=>l==null||!isFinite(Number(l))||isNaN(Number(l)))){console.warn("‚ö†Ô∏è Descriptor contains invalid values, creating clean version");const l=new Float32Array(n.length);for(let x=0;x<n.length;x++){const g=n[x];l[x]=g==null||!isFinite(Number(g))||isNaN(Number(g))?0:Number(g)}return l}return console.log("‚úÖ Face detection completed successfully"),n}catch(t){throw console.error("‚ùå Error in face detection:",t),t instanceof Error&&t.message==="Face detection timeout"&&console.log("‚è∞ Face detection timed out - try again"),t}}async function sa(s){try{if(await ne(),!s)return[];s instanceof HTMLVideoElement&&s.readyState<2&&await new Promise(o=>{s.addEventListener("loadeddata",o,{once:!0}),setTimeout(o,100)});const t=it(s,new ls({inputSize:224,scoreThreshold:.05})).withFaceLandmarks().withFaceDescriptors(),a=new Promise((o,l)=>setTimeout(()=>l(new Error("Face detection timeout")),1e3)),r=await Promise.race([t,a]);if(!r||r.length===0)return[];const n=[];for(const o of r){if(!(o!=null&&o.descriptor)||!(o!=null&&o.detection))continue;const l=o.detection.box,x=o.detection.score,g=l.width/l.height,u=l.width*l.height;if(g<.2||g>5||u<200||u>2e5||x<.05)continue;const h=o.descriptor;h.length!==0&&n.push({descriptor:h,box:{x:l.x,y:l.y,width:l.width,height:l.height},score:x})}return n}catch{return[]}}function ta(s,t){let a=0;for(let r=0;r<s.length;r++){const n=s[r]-t[r];a+=n*n}return Math.sqrt(a)}function aa(s,t,a=.4){if(console.log(`üîç Starting face matching with ${t.length} enrolled students`),console.log(`üìè Using threshold: ${a}`),!t||t.length===0)return console.log("‚ùå No enrolled students to match against"),null;let r=null;for(const n of t)try{const o=ta(s,n.descriptor);console.log(`üìä Distance to ${n.name}: ${o.toFixed(4)}`),(r===null||o<r.distance)&&(r={id:n.id,name:n.name,distance:o},console.log(`‚úÖ New best match: ${n.name} with distance ${o.toFixed(4)}`))}catch(o){console.error(`‚ùå Error computing distance for ${n.name}:`,o)}return r?(console.log(`üéØ Final best match: ${r.name} with distance ${r.distance.toFixed(4)}`),console.log(`üìè Threshold check: ${r.distance.toFixed(4)} <= ${a} ? ${r.distance<=a}`),r.distance<=a?r:null):(console.log("‚ùå No valid matches found"),null)}function ra(s){var t;try{if(console.log("Converting descriptor to base64 (simple method)..."),console.log("Descriptor type:",typeof s),console.log("Descriptor constructor:",s.constructor.name),console.log("Descriptor length:",s.length),console.log("Descriptor buffer length:",s.buffer.byteLength),!s||s.length===0)throw new Error("Invalid descriptor: empty or null");if(!Array.from(s).some(l=>l!=null&&isFinite(l)&&!isNaN(l)))throw new Error("Invalid descriptor: no valid values found");const r=new Uint8Array(s.buffer);if(console.log("Bytes length:",r.length),r.length===0)throw new Error("Invalid descriptor: empty buffer");let n="";for(let l=0;l<r.byteLength;l++)n+=String.fromCharCode(r[l]);const o=btoa(n);if(console.log("Base64 conversion successful, length:",o.length),!o||o.length===0)throw new Error("Base64 conversion resulted in empty string");return o}catch(a){throw console.error("Error in simple base64 conversion:",a),console.error("Descriptor details:",{type:typeof s,constructor:(t=s==null?void 0:s.constructor)==null?void 0:t.name,length:s==null?void 0:s.length,buffer:s==null?void 0:s.buffer}),new Error("Failed to convert face descriptor")}}function na(s){try{const t=atob(s),a=new Uint8Array(t.length);for(let r=0;r<t.length;r++)a[r]=t.charCodeAt(r);return new Float32Array(a.buffer)}catch(t){throw console.error("Error in simple base64 decoding:",t),new Error("Failed to parse face descriptor")}}const ia=()=>{const{classId:s}=pe(),[t,a]=i.useState(!1),[r,n]=i.useState(0),{data:o}=Cs(s??""),l=(o==null?void 0:o.length)??0,x=i.useRef(null),[g,u]=i.useState(new Set),[f,v]=i.useState(null),[h,p]=i.useState("idle"),[N,C]=i.useState(!1),[_,D]=i.useState([]),[$,z]=i.useState([]),[de,M]=i.useState(""),[K,ve]=i.useState("classroom"),[ie,oe]=i.useState(!1),[Q,le]=i.useState(null),[Ne,d]=i.useState(!1),[E,O]=i.useState({}),[J,_s]=i.useState(!1),[ee,qe]=i.useState("environment"),V=c=>{N&&D(b=>[...b.slice(-9),`${new Date().toLocaleTimeString()}: ${c}`])},Os=c=>c.name==="NotAllowedError"?"Camera permission denied. Please allow camera access and refresh the page.":c.name==="NotFoundError"?"No camera found. Please connect a camera and try again.":c.name==="NotSupportedError"?"Camera not supported. Please use HTTPS or localhost.":c.name==="NotReadableError"?"Camera is being used by another application. Please close other apps and try again.":c.message.includes("HTTPS")?"HTTPS Required: Camera access requires HTTPS on mobile devices.":`Camera error: ${c.message||"Unknown error"}`,Ue=async()=>{a(!0),le(null),M("Requesting camera permission...");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device");let c;const b=[{video:{facingMode:{exact:ee},width:{ideal:1280,min:640},height:{ideal:720,min:480}}},{video:{facingMode:ee,width:{ideal:1280},height:{ideal:720}}},{video:{width:{ideal:1280,min:640},height:{ideal:720,min:480}}},{video:!0}];let F=!1,P;for(const S of b)try{console.log("Trying camera config:",S),c=await navigator.mediaDevices.getUserMedia(S),F=!0,V(`‚úÖ Camera started with facing: ${ee}`);break}catch(T){console.log("Camera config failed:",T.message),P=T;continue}if(!F)throw P||new Error("All camera configurations failed");if(x.current){x.current.srcObject=c,M("Camera ready! Detecting faces...");const S=c.getVideoTracks()[0];if(S){const T=S.getSettings();V(`üìπ Camera: ${T.width}x${T.height}, facing: ${T.facingMode||"unknown"}`)}}ne().then(()=>{M("Face recognition ready! Point camera at students."),V("üß† Face recognition models loaded")}).catch(S=>{M("Camera ready! Basic detection active..."),V(`‚ö†Ô∏è Model loading failed: ${S.message}`),_s(!0)}),setTimeout(()=>{M(`Scanning for faces... (${ee} camera)`)},500)}catch(c){console.error("Camera access failed:",c);const b=Os(c);le(b),M("Camera access failed. Try manual mode or check permissions."),V(`‚ùå Camera failed: ${c.message}`)}},Ls=async()=>{t?(me(),qe(ee==="environment"?"user":"environment"),setTimeout(()=>{Ue()},500)):qe(ee==="environment"?"user":"environment")},me=()=>{var c;(c=x.current)!=null&&c.srcObject&&(x.current.srcObject.getTracks().forEach(F=>F.stop()),x.current.srcObject=null)},qs=c=>{O(b=>{const F=b[c]||"unset",P=F==="unset"?"present":F==="present"?"absent":"unset";return P==="present"&&!g.has(c)?(u(S=>new Set([...S,c])),n(S=>S+1)):P!=="present"&&g.has(c)&&(u(S=>{const T=new Set(S);return T.delete(c),T}),n(S=>S-1)),{...b,[c]:P}})},Us=async()=>{var T;if(!s)return;me(),a(!1);const c=new Date().toISOString().slice(0,10),b=new Set,F=new Set;(o??[]).forEach(k=>{const te=k.students.id,Y=E[te];Y==="present"||Y==="unset"&&g.has(te)?b.add(te):F.add(te)});const P=b.size,S=F.size;await A.from("attendance_sessions").insert({class_id:s,teacher_id:(T=(await A.auth.getUser()).data.user)==null?void 0:T.id,date:c,total_students:l,present_count:P,absent_count:S}),b.size>0&&await A.from("attendance_records").insert(Array.from(b).map(k=>({class_id:s,student_id:k,date:c,status:"present"}))),F.size>0&&await A.from("attendance_records").insert(Array.from(F).map(k=>({class_id:s,student_id:k,date:c,status:"absent"}))),window.location.href=`/results/${s}`};i.useEffect(()=>{let c=0,b=!1,F=0,P=null;const S=(o??[]).filter(k=>!!k.students.facial_id).map(k=>({id:k.students.id,name:k.students.full_name,descriptor:na(k.students.facial_id)})),T=async()=>{if(!(!t||!x.current||b)){if(Date.now()-F<150){c=requestAnimationFrame(T);return}F=Date.now();try{P&&clearTimeout(P);const k=await sa(x.current);if(V(`üîç Detection attempt: ${k.length} faces found`),k.length>0){const te=k.map((Y,ae)=>({id:`detecting_${ae}`,name:"Detecting...",confidence:Y.score,accuracy:0,position:Y.box,isRecognized:!1}));if(z(te),p("recognizing"),S.length>0){let Y=!1;const ae=[];let Vs=0;for(const U of k){const B=aa(U.descriptor,S,.5);if(B){const Be=Math.max(0,Math.min(100,(1-B.distance)*100)),Ve=!g.has(B.id);ae.push({id:B.id,name:B.name,confidence:U.score,accuracy:Be,position:U.box,isRecognized:Ve}),Ve&&(Y=!0,Vs++,V(`‚úÖ Recognized: ${B.name} (accuracy: ${Be.toFixed(1)}%)`))}else ae.push({id:`unknown_${Date.now()}_${Math.random()}`,name:"Unknown",confidence:U.score,accuracy:0,position:U.box,isRecognized:!1})}if(z(ae),Y){const U=new Set(g);ae.forEach(B=>{B.isRecognized&&!g.has(B.id)&&U.add(B.id)}),u(U),n(U.size),p("success"),v(new Date),M(`${U.size}/${l} students recognized - ${k.length} faces detected`),P=setTimeout(()=>{p("idle")},2e3)}else p("idle"),M(`${k.length} face(s) detected - ${g.size}/${l} recognized`)}else p("idle"),M(`${k.length} face(s) detected - No enrolled students`)}else p("idle"),M("No faces detected. Try moving closer or adjusting lighting"),z([]),V("‚ùå No faces detected in this frame")}catch(k){p("failed"),M("Detection error. Try again..."),V(`‚ùå Detection error: ${k}`),z([]),P=setTimeout(()=>{p("idle")},1e3)}!b&&t&&(c=requestAnimationFrame(T))}};return t&&(c=requestAnimationFrame(T)),()=>{b=!0,cancelAnimationFrame(c),P&&clearTimeout(P)}},[o,t,g,l,r,f]),i.useEffect(()=>{(()=>{const b=navigator.userAgent||navigator.vendor||window.opera,F=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(b.toLowerCase());oe(F),F&&location.protocol!=="https:"&&location.hostname!=="localhost"&&le("HTTPS Required: Camera access requires HTTPS on mobile devices. Please use https:// or localhost")})(),As()},[]),i.useEffect(()=>()=>{me()},[]);const Bs=()=>{switch(h){case"success":return"ring-4 ring-green-400 ring-opacity-75";case"failed":return"ring-4 ring-red-400 ring-opacity-75";case"recognizing":return"ring-4 ring-yellow-400 ring-opacity-75";default:return""}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-gradient-primary shadow-soft",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,className:"text-primary-foreground hover:bg-primary-foreground/10",children:e.jsx(X,{to:"/",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-primary-foreground",children:"Take Attendance"}),e.jsx("p",{className:"text-sm text-primary-foreground/80",children:"Math 101"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ve(K==="classroom"?"single":"classroom"),className:"text-primary-foreground hover:bg-primary-foreground/10",title:K==="classroom"?"Switch to Single Face Mode":"Switch to Classroom Mode",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:Ls,className:"text-primary-foreground hover:bg-primary-foreground/10",title:`Switch to ${ee==="environment"?"Front":"Back"} Camera`,children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>C(!N),className:"text-primary-foreground hover:bg-primary-foreground/10",children:N?e.jsx(lt,{className:"w-4 h-4"}):e.jsx(ct,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>d(!0),className:"text-primary-foreground hover:bg-primary-foreground/10",title:"Manual Attendance",children:e.jsx(Qe,{className:"w-4 h-4"})})]})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:t?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[e.jsx(y,{className:`shadow-medium overflow-hidden transition-all duration-300 ${Bs()}`,children:e.jsxs("div",{className:"relative aspect-[4/3] bg-camera-overlay",children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"translateZ(0)"}}),e.jsx("div",{className:"absolute top-4 left-4 right-4",children:e.jsx("div",{className:"bg-background/95 backdrop-blur-sm px-4 py-2 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full animate-pulse ${h==="success"?"bg-green-500":h==="failed"?"bg-red-500":h==="recognizing"?"bg-yellow-500":"bg-blue-500"}`}),e.jsxs("span",{className:"text-sm font-medium",children:[K==="classroom"?"Classroom Scan":"Single Face"," - ",r,"/",l," recognized"]}),$.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",$.length," faces detected)"]})]}),e.jsx("div",{className:"w-20 h-1 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${l>0?r/l*100:0}%`}})})]})})}),ie&&$.length===0&&e.jsx("div",{className:"absolute top-20 left-4 right-4 pointer-events-none",children:e.jsxs("div",{className:"bg-background/90 backdrop-blur-sm px-4 py-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Mobile Camera Mode"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[K==="classroom"?"Point camera at class":"Point camera at face"," ‚Ä¢ Tap to focus"]})]})}),!ie&&K==="classroom"&&$.length===0&&e.jsx("div",{className:"absolute top-20 left-4 right-4 pointer-events-none",children:e.jsxs("div",{className:"bg-background/90 backdrop-blur-sm px-4 py-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Classroom Scanning Mode"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Point camera at class ‚Ä¢ Multiple faces detected automatically"})]})}),de&&e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsx("div",{className:"bg-background/95 backdrop-blur-sm px-4 py-2 rounded-lg",children:e.jsx("p",{className:"text-sm text-center text-muted-foreground",children:de})})}),$.map((c,b)=>e.jsxs("div",{className:"absolute",style:{left:`${c.position.x}px`,top:`${c.position.y}px`,width:`${c.position.width}px`,height:`${c.position.height}px`},children:[e.jsx("div",{className:`absolute border-2 rounded-lg transition-all duration-200 ${c.isRecognized?"border-green-500":c.name==="Detecting..."?"border-blue-500":c.name==="Unknown"?"border-yellow-500":"border-red-500"}`,style:{width:"100%",height:"100%",backgroundColor:"transparent"}}),e.jsx("div",{className:`absolute -top-8 left-0 px-2 py-1 rounded-md text-xs font-medium whitespace-nowrap ${c.isRecognized?"bg-green-500 text-white":c.name==="Detecting..."?"bg-blue-500 text-white":c.name==="Unknown"?"bg-yellow-500 text-white":"bg-red-500 text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:c.name}),c.accuracy>0&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",c.accuracy.toFixed(0),"%)"]}),c.isRecognized&&e.jsx("span",{children:"‚úÖ"})]})})]},`${c.id}_${b}`))]})}),e.jsx(y,{className:"bg-card/50 backdrop-blur-sm",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-green-600 mb-1",children:r}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Recognized"}),e.jsx("div",{className:"w-full h-2 bg-muted rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${l>0?r/l*100:0}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-gray-600 mb-1",children:l}),e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total Students"}),e.jsx("div",{className:"w-full h-2 bg-muted rounded-full mt-2",children:e.jsx("div",{className:"h-full bg-gray-400 w-full"})})]})]})})}),N&&e.jsxs(y,{className:"bg-muted/50",children:[e.jsx(R,{children:e.jsx(I,{className:"text-sm",children:"Debug Console"})}),e.jsx(w,{children:e.jsx("div",{className:"bg-black text-green-400 p-3 rounded font-mono text-xs h-32 overflow-y-auto",children:_.map((c,b)=>e.jsx("div",{children:c},b))})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(m,{variant:"success",size:"lg",className:"w-full",onClick:Us,disabled:r===0&&Object.values(E).filter(c=>c==="present").length===0,children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Complete Scan (",r," auto + ",Object.values(E).filter(c=>c==="present").length," manual)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(m,{variant:"outline",onClick:()=>d(!0),className:"flex-1",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Manual Override"]}),e.jsx(m,{variant:"outline",onClick:()=>{me(),a(!1),n(0),u(new Set),p("idle"),M(""),z([]),O({})},className:"flex-1",children:"Reset Scan"})]})]})]}):e.jsx("div",{className:"max-w-md mx-auto space-y-6",children:e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{className:"text-center",children:e.jsxs(I,{className:"flex items-center justify-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Ready to Scan"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-32 h-32 mx-auto border-4 border-dashed border-primary/30 rounded-full flex items-center justify-center",children:e.jsx(W,{className:"w-12 h-12 text-primary/60"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Position your camera to scan the classroom"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Total Students:"}),e.jsx("span",{className:"font-semibold",children:l})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Expected Present:"}),e.jsxs("span",{className:"font-semibold text-success",children:["~",Math.floor(l*.85)]})]})]}),Q&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-destructive font-medium mb-2",children:"Camera Access Issue"}),e.jsx("div",{className:"text-xs text-destructive/80 mb-3",children:Q}),Q.includes("HTTPS")&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Solution:"})," Use HTTPS or localhost. For mobile testing, try:",e.jsx("br",{}),"‚Ä¢ ",e.jsx("code",{children:"https://192.168.1.5:8080"}),e.jsx("br",{}),"‚Ä¢ Or use ",e.jsx("code",{children:"localhost:8080"})," on your computer"]})]}),e.jsxs(m,{variant:"camera",size:"lg",className:"w-full",onClick:Ue,disabled:!!Q,children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),Q?"Fix Camera Issue First":"Start Scanning"]})]})]})})}),e.jsx(Ts,{open:Ne,onOpenChange:d,children:e.jsxs($e,{className:"max-w-md",children:[e.jsxs(_e,{children:[e.jsx(Oe,{children:"Manual Attendance Override"}),e.jsx(Le,{children:"Mark students present or absent manually. This overrides automatic detection."})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(o??[]).map(c=>{const b=c.students.id,F=c.students.full_name,P=g.has(b),S=E[b]||"unset",T=S!=="unset"?S:P?"present":"absent";return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:F}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[P&&S==="unset"&&e.jsx(G,{variant:"outline",className:"text-xs mr-2",children:"Auto Detected"}),S!=="unset"&&e.jsx(G,{variant:"secondary",className:"text-xs mr-2",children:"Manual Override"}),"ID: ",c.students.student_id]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(m,{variant:T==="present"?"default":"outline",size:"sm",onClick:()=>qs(b),className:`w-20 ${T==="present"?"bg-green-600 hover:bg-green-700":""}`,children:T==="present"?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Present"]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-3 h-3 mr-1"}),T==="absent"?"Absent":"Unset"]})})})]},b)})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Object.values(E).filter(c=>c==="present").length+g.size-Object.keys(E).filter(c=>E[c]==="absent"&&g.has(c)).length,"/",l," Present"]}),e.jsx(m,{onClick:()=>d(!1),children:"Done"})]})]})})]})},oa=()=>{const{classId:s}=pe(),{data:t}=Ss(s??""),[a,r]=i.useState([]),[n,o]=i.useState([]),[l,x]=i.useState(new Date().toLocaleDateString()),[g,u]=i.useState(new Date().toLocaleTimeString());i.useEffect(()=>{(async()=>{if(!s)return;const p=new Date().toISOString().slice(0,10),{data:N}=await A.from("attendance_records").select("student_id, students ( id, full_name )").eq("class_id",s).eq("date",p).eq("status","present"),{data:C}=await A.from("attendance_records").select("student_id, students ( id, full_name )").eq("class_id",s).eq("date",p).eq("status","absent");r((N??[]).map(D=>({id:D.students.id,full_name:D.students.full_name}))),o((C??[]).map(D=>({id:D.students.id,full_name:D.students.full_name})));const _=new Date;x(_.toLocaleDateString()),u(_.toLocaleTimeString())})()},[s]);const f=a.length+n.length,v=f>0?Math.round(a.length/f*100):0;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-gradient-primary shadow-soft",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,className:"text-primary-foreground hover:bg-primary-foreground/10",children:e.jsx(X,{to:"/",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-primary-foreground",children:"Attendance Complete"}),e.jsxs("p",{className:"text-sm text-primary-foreground/80",children:[(t==null?void 0:t.name)??"Class"," ‚Ä¢ ",l]})]}),e.jsxs(G,{variant:"secondary",className:"text-sm",children:[v,"% Present"]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(y,{className:"shadow-soft",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:f}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"})]})}),e.jsx(y,{className:"shadow-soft",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:a.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Present"})]})}),e.jsx(y,{className:"shadow-soft",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:n.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Absent"})]})}),e.jsx(y,{className:"shadow-soft",children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[v,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Rate"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{className:"bg-success-bg/50",children:e.jsxs(I,{className:"flex items-center gap-2 text-success",children:[e.jsx(he,{className:"w-5 h-5"}),"Present (",a.length,")"]})}),e.jsx(w,{className:"p-0",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:a.map(h=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border last:border-0 hover:bg-muted/30",children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{className:"flex-1",children:h.full_name}),e.jsx(G,{variant:"outline",className:"text-xs text-success border-success/30",children:"Present"})]},h.id))})})]}),e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{className:"bg-warning-bg/50",children:e.jsxs(I,{className:"flex items-center gap-2 text-warning",children:[e.jsx(mt,{className:"w-5 h-5"}),"Absent (",n.length,")"]})}),e.jsx(w,{className:"p-0",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:n.map(h=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border last:border-0 hover:bg-muted/30",children:[e.jsx("div",{className:"w-2 h-2 bg-warning rounded-full"}),e.jsx("span",{className:"flex-1",children:h.full_name}),e.jsx(G,{variant:"outline",className:"text-xs text-warning border-warning/30",children:"Absent"})]},h.id))})})]})]}),e.jsx(y,{className:"mt-6 shadow-soft",children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Scanned at ",g]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Session: ",s]})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(m,{variant:"default",className:"flex-1",asChild:!0,children:e.jsx(X,{to:"/",children:"Return to Dashboard"})}),e.jsx(m,{variant:"outline",className:"flex-1",children:"Share Results"}),e.jsx(m,{variant:"outline",className:"flex-1",children:"Export Data"})]})]})]})},la=xt,ca=ht,da=ut,Es=i.forwardRef(({className:s,...t},a)=>e.jsx(cs,{className:j("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Es.displayName=cs.displayName;const Fs=i.forwardRef(({className:s,...t},a)=>e.jsxs(da,{children:[e.jsx(Es,{}),e.jsx(ds,{ref:a,className:j("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Fs.displayName=ds.displayName;const Ds=({className:s,...t})=>e.jsx("div",{className:j("flex flex-col space-y-2 text-center sm:text-left",s),...t});Ds.displayName="AlertDialogHeader";const Ps=({className:s,...t})=>e.jsx("div",{className:j("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Ps.displayName="AlertDialogFooter";const Rs=i.forwardRef(({className:s,...t},a)=>e.jsx(ms,{ref:a,className:j("text-lg font-semibold",s),...t}));Rs.displayName=ms.displayName;const Is=i.forwardRef(({className:s,...t},a)=>e.jsx(us,{ref:a,className:j("text-sm text-muted-foreground",s),...t}));Is.displayName=us.displayName;const Ms=i.forwardRef(({className:s,...t},a)=>e.jsx(xs,{ref:a,className:j(Me(),s),...t}));Ms.displayName=xs.displayName;const zs=i.forwardRef(({className:s,...t},a)=>e.jsx(hs,{ref:a,className:j(Me({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));zs.displayName=hs.displayName;const ma=()=>{const{classId:s}=pe(),[t,a]=i.useState("roster"),{data:r}=Ss(s??""),{data:n}=Cs(s??""),o=Jt();H();const l=i.useMemo(()=>(n??[]).map(u=>({id:u.students.id,name:u.students.full_name,studentId:u.students.student_id,enrolled:u.enrolled_at,status:"active"})),[n]),x=[],g=async(u,f)=>{if(s)try{await o.mutateAsync({studentId:u,classId:s})}catch{}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-gradient-primary shadow-soft",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,className:"text-primary-foreground hover:bg-primary-foreground/10",children:e.jsx(X,{to:"/",children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-primary-foreground",children:(r==null?void 0:r.name)??"Class"}),e.jsxs("p",{className:"text-sm text-primary-foreground/80",children:[(r==null?void 0:r.subject)??""," ",r!=null&&r.period?`‚Ä¢ ${r==null?void 0:r.period}`:""]})]}),e.jsxs(G,{variant:"secondary",className:"text-sm",children:[l.length," Active"]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs(m,{variant:t==="roster"?"default":"outline",onClick:()=>a("roster"),className:"flex-1",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Class Roster"]}),e.jsxs(m,{variant:t==="settings"?"default":"outline",onClick:()=>a("settings"),className:"flex-1",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Settings"]})]}),t==="roster"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(m,{variant:"camera",className:"h-12",asChild:!0,children:e.jsxs(X,{to:`/enroll/${s}`,children:[e.jsx(Re,{className:"w-5 h-5 mr-2"}),"Enroll New Student"]})}),e.jsx(m,{variant:"outline",className:"h-12",asChild:!0,children:e.jsxs(X,{to:`/scan/${s}`,children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Take Attendance"]})}),e.jsxs(m,{variant:"outline",className:"h-12",children:[e.jsx(ft,{className:"w-5 h-5 mr-2"}),"View History"]})]}),e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Active Students (",l.length,")"]})}),e.jsx(w,{className:"p-0",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:l.map((u,f)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border last:border-0 hover:bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-primary",children:u.name.split(" ").map(v=>v[0]).join("")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u.studentId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx(G,{variant:"outline",className:"text-xs",children:"Active"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Enrolled ",new Date(u.enrolled).toLocaleDateString()]})]}),e.jsxs(la,{children:[e.jsx(ca,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",disabled:o.isPending,children:e.jsx(gt,{className:"w-4 h-4"})})}),e.jsxs(Fs,{children:[e.jsxs(Ds,{children:[e.jsx(Rs,{children:"Delete Student"}),e.jsxs(Is,{children:["Are you sure you want to delete ",e.jsx("strong",{children:u.name}),"? This action cannot be undone and will remove all their face data and attendance records."]})]}),e.jsxs(Ps,{children:[e.jsx(zs,{children:"Cancel"}),e.jsx(Ms,{onClick:()=>g(u.id,u.name),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:o.isPending,children:o.isPending?"Deleting...":"Delete"})]})]})]})]})]},u.id))})})]}),x.length>0&&e.jsxs(y,{className:"shadow-soft",children:[e.jsx(R,{children:e.jsxs(I,{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Z,{className:"w-5 h-5"}),"Inactive Students (",x.length,")"]})}),e.jsx(w,{className:"p-0",children:x.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border last:border-0 opacity-60",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-muted rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-muted-foreground",children:u.name.split(" ").map(f=>f[0]).join("")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u.studentId})]})]}),e.jsx(G,{variant:"outline",className:"text-xs text-muted-foreground",children:"Inactive"})]},u.id))})]})]}),t==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{children:e.jsx(I,{children:"Class Information"})}),e.jsx(w,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Class Name"}),e.jsx("div",{className:"mt-1 p-3 bg-muted rounded-md",children:(r==null?void 0:r.name)??""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Subject"}),e.jsx("div",{className:"mt-1 p-3 bg-muted rounded-md",children:(r==null?void 0:r.subject)??""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Period"}),e.jsx("div",{className:"mt-1 p-3 bg-muted rounded-md",children:(r==null?void 0:r.period)??""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Total Enrolled"}),e.jsxs("div",{className:"mt-1 p-3 bg-muted rounded-md",children:[l.length," students"]})]})]})})]}),e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{children:e.jsx(I,{children:"Actions"})}),e.jsxs(w,{className:"space-y-3",children:[e.jsx(m,{variant:"outline",className:"w-full justify-start",children:"Export Student List"}),e.jsx(m,{variant:"outline",className:"w-full justify-start",children:"Reset All Face Data"}),e.jsx(m,{variant:"destructive",className:"w-full justify-start",children:"Archive Class"})]})]})]})]})]})},ua=()=>{const{classId:s}=pe(),[t,a]=i.useState("info"),[r,n]=i.useState(""),[o,l]=i.useState(()=>`STU${Date.now()}`),[x,g]=i.useState(!1),[u,f]=i.useState(0),[v,h]=i.useState(""),[p,N]=i.useState(!1),[C,_]=i.useState(!1),D=i.useRef(null),{toast:$}=H(),{user:z,session:de}=Ie(),M=Kt(),K=Qt();i.useEffect(()=>{As()},[]);const ve=async()=>{try{const d=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});D.current&&(D.current.srcObject=d)}catch(d){console.error("Camera access failed:",d)}},ie=i.useCallback(()=>{var d;(d=D.current)!=null&&d.srcObject&&(D.current.srcObject.getTracks().forEach(O=>O.stop()),D.current.srcObject=null)},[]),oe=()=>{switch(t){case"info":a("position"),ne().finally(ve);break;case"position":a("capture");break;case"capture":a("angles");break;case"angles":a("complete");break}},Q=async()=>{if(D.current){g(!0),f(10);try{console.log("Starting capture process..."),f(20),await ne(),f(30),console.log("Calling detectSingleFaceDescriptor...");const d=await ea(D.current);if(!d){console.log("No descriptor returned from detection"),$({title:"No face detected",description:"Please center your face and try again",variant:"destructive"}),g(!1),f(0);return}if(f(50),console.log("Descriptor received, length:",d.length),console.log("Descriptor sample:",d.slice(0,5)),d.length===0)throw new Error("Invalid descriptor: empty array");console.log("Converting to base64...");const E=ra(d);if(console.log("Base64 conversion successful, length:",E.length),console.log("Base64 sample:",E.substring(0,50)),!E||E.length===0)throw new Error("Failed to convert descriptor to base64");h(E),f(100),g(!1),$({title:"Face captured successfully",description:"Reference photo saved"}),setTimeout(()=>oe(),400)}catch(d){console.error("Capture error details:",{message:d==null?void 0:d.message,stack:d==null?void 0:d.stack,name:d==null?void 0:d.name,error:d}),$({title:"Capture failed",description:(d==null?void 0:d.message)??"Unexpected error during face capture",variant:"destructive"}),g(!1),f(0)}}},le=i.useCallback(async()=>{if(s&&v){if(!z){$({title:"Authentication Error",description:"Please sign in to enroll students",variant:"destructive"});return}if(p||C){console.log("Already saving or enrollment completed, ignoring duplicate request");return}N(!0);try{console.log("User authentication status:",{user:z==null?void 0:z.id,email:z==null?void 0:z.email,session:!!de,classId:s});const{data:d,error:E}=await A.from("profiles").select("*").eq("id",z.id).single();console.log("Profile check:",{profile:d,profileError:E}),console.log("Creating student with data:",{student_id:o,full_name:r,facial_id:v.substring(0,50)+"..."});const O=await M.mutateAsync({student_id:o,full_name:r,facial_id:v});console.log("Student created successfully:",O);const J=O==null?void 0:O.id;if(!J)throw new Error("Student creation failed");console.log("Enrolling student in class:",{classId:s,studentId:J}),await K.mutateAsync({classId:s,studentId:J}),console.log("Enrollment completed successfully"),_(!0),$({title:"Enrollment complete",description:`${r} enrolled successfully`}),ie(),a("complete")}catch(d){console.error("Enrollment error details:",{message:d==null?void 0:d.message,code:d==null?void 0:d.code,details:d==null?void 0:d.details,hint:d==null?void 0:d.hint,error:d}),$({title:"Save failed",description:(d==null?void 0:d.message)??"Could not save enrollment",variant:"destructive"})}finally{N(!1)}}},[s,M,v,K,ie,o,r,$]),Ne=()=>{switch(t){case"info":return e.jsxs(y,{className:"shadow-medium max-w-md mx-auto",children:[e.jsx(R,{className:"text-center",children:e.jsxs(I,{className:"flex items-center justify-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Student Information"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"name",children:"Full Name"}),e.jsx(L,{id:"name",placeholder:"Enter student's full name",value:r,onChange:d=>n(d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"studentId",children:"Student ID"}),e.jsx(L,{id:"studentId",placeholder:"Enter student ID",value:o,onChange:d=>l(d.target.value)})]}),e.jsx(m,{variant:"camera",size:"lg",className:"w-full mt-6",onClick:oe,disabled:!r.trim()||!o.trim(),children:"Continue to Face Setup"})]})]});case"position":return e.jsx("div",{className:"max-w-md mx-auto space-y-4",children:e.jsxs(y,{className:"shadow-medium",children:[e.jsxs(R,{className:"text-center",children:[e.jsx(I,{children:"Position Your Face"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Center your face in the circle and look directly at the camera"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"relative aspect-square bg-camera-overlay rounded-lg overflow-hidden",children:[e.jsx("video",{ref:D,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-48 h-48 border-4 border-primary/60 rounded-full"}),e.jsx("div",{className:"absolute inset-6 border-2 border-camera-success/80 rounded-full"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-camera-success rounded-full"})]})}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"bg-success/90 text-success-foreground px-3 py-1 rounded-full text-xs font-medium",children:"Face Detected - Hold Still"})})]}),e.jsxs(m,{variant:"success",size:"lg",className:"w-full mt-4",onClick:oe,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Position Looks Good"]})]})]})});case"capture":return e.jsx("div",{className:"max-w-md mx-auto space-y-4",children:e.jsxs(y,{className:"shadow-medium",children:[e.jsxs(R,{className:"text-center",children:[e.jsx(I,{children:"Capturing Reference"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hold still while we capture your primary reference photo"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"relative aspect-square bg-camera-overlay rounded-lg overflow-hidden",children:[e.jsx("video",{ref:D,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-48 h-48 border-4 border-camera-success rounded-full"}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-primary-foreground",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[u,"%"]}),e.jsx("div",{className:"text-xs",children:"Capturing..."})]})})]})}),x&&e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsx("div",{className:"bg-background/80 rounded-full h-2",children:e.jsx("div",{className:"bg-camera-success h-2 rounded-full transition-all duration-200",style:{width:`${u}%`}})})})]}),e.jsxs(m,{variant:"camera",size:"lg",className:"w-full mt-4",onClick:Q,disabled:x,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),x?"Capturing...":"Capture Reference"]})]})]})});case"angles":return e.jsx("div",{className:"max-w-md mx-auto space-y-4",children:e.jsxs(y,{className:"shadow-medium",children:[e.jsxs(R,{className:"text-center",children:[e.jsx(I,{children:"Capture Different Angles"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Step 1:"})," Position your face in the circle"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Step 2:"}),' Click "Capture Face Angles" button']}),e.jsxs("p",{children:[e.jsx("strong",{children:"Step 3:"})," Slowly turn your head left, then right while capturing"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Step 4:"}),' Click "Complete Enrollment" when done']})]})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"relative aspect-square bg-camera-overlay rounded-lg overflow-hidden",children:[e.jsx("video",{ref:D,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-48 h-48 border-4 border-primary/60 rounded-full"}),e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-8",children:e.jsx("div",{className:"text-primary-foreground text-2xl animate-pulse",children:"‚Üê"})}),e.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-8",children:e.jsx("div",{className:"text-primary-foreground text-2xl animate-pulse",children:"‚Üí"})})]})}),e.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"bg-primary/90 text-primary-foreground px-3 py-1 rounded-full text-xs font-medium",children:"Turn Head Slowly Left ‚Üí Right"})})]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs(m,{variant:"outline",size:"lg",className:"w-full",onClick:Q,disabled:x||p||C,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),x?"Capturing...":"Capture Face Angles"]}),e.jsxs(m,{variant:"success",size:"lg",className:"w-full",onClick:le,disabled:x||!v||p||C,children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),C?"Enrollment Complete!":p?"Saving...":"Complete Enrollment"]})]})]})]})});case"complete":return e.jsx("div",{className:"max-w-md mx-auto space-y-4",children:e.jsxs(y,{className:"shadow-medium",children:[e.jsx(R,{className:"text-center",children:e.jsxs(I,{className:"flex items-center justify-center gap-2 text-success",children:[e.jsx(he,{className:"w-6 h-6"}),"Enrollment Complete!"]})}),e.jsxs(w,{className:"text-center space-y-4",children:[e.jsxs("div",{className:"p-6 bg-success-bg rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold",children:r}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o}),e.jsx("div",{className:"text-xs text-success mt-2",children:"Successfully enrolled in Math 101"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:"‚úì Primary reference captured"}),e.jsx("p",{children:"‚úì Multiple angles processed"}),e.jsx("p",{children:"‚úì Face signature created"}),e.jsx("p",{children:"‚úì Ready for attendance scanning"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(m,{variant:"camera",className:"flex-1",onClick:()=>{n(""),l(""),h(""),a("info")},children:"Enroll Another Student"}),e.jsx(m,{variant:"outline",className:"flex-1",asChild:!0,children:e.jsx(X,{to:`/class/${s}`,children:"Return to Class"})})]})]})]})})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-gradient-primary shadow-soft",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,className:"text-primary-foreground hover:bg-primary-foreground/10",children:e.jsx(X,{to:`/class/${s}`,children:e.jsx(je,{className:"w-4 h-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-primary-foreground",children:"Enroll New Student"}),e.jsx("p",{className:"text-sm text-primary-foreground/80",children:"Math 101"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("div",{className:"flex items-center justify-center space-x-2 mb-8",children:["info","position","capture","angles","complete"].map((d,E)=>{const O=d===t,J=["info","position","capture","angles","complete"].indexOf(t)>E;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium ${O?"bg-primary text-primary-foreground":J?"bg-success text-success-foreground":"bg-muted text-muted-foreground"}`,children:J?"‚úì":E+1}),E<4&&e.jsx("div",{className:`w-8 h-0.5 ${J?"bg-success":"bg-muted"}`})]},d)})}),e.jsx("main",{children:Ne()})]})]})},xa=vt,$s=i.forwardRef(({className:s,...t},a)=>e.jsx(fs,{ref:a,className:j("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));$s.displayName=fs.displayName;const Ae=i.forwardRef(({className:s,...t},a)=>e.jsx(gs,{ref:a,className:j("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));Ae.displayName=gs.displayName;const Ee=i.forwardRef(({className:s,...t},a)=>e.jsx(ps,{ref:a,className:j("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Ee.displayName=ps.displayName;const ha=()=>{const[s,t]=i.useState(""),[a,r]=i.useState(""),[n,o]=i.useState(""),[l,x]=i.useState(!1),{signIn:g,signUp:u,user:f}=Ie(),v=os(),{toast:h}=H();i.useEffect(()=>{f&&v("/")},[f,v]);const p=async C=>{if(C.preventDefault(),!s||!a){h({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}x(!0);const{error:_}=await g(s,a);h(_?{title:"Sign In Failed",description:_.message,variant:"destructive"}:{title:"Welcome back!",description:"Successfully signed in"}),x(!1)},N=async C=>{if(C.preventDefault(),!s||!a||!n){h({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}x(!0);const{error:_}=await u(s,a,n);h(_?{title:"Sign Up Failed",description:_.message,variant:"destructive"}:{title:"Account Created!",description:"Please check your email to confirm your account"}),x(!1)};return e.jsx("div",{className:"min-h-screen bg-gradient-elegant flex items-center justify-center p-4",children:e.jsxs(y,{className:"w-full max-w-md",children:[e.jsxs(R,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(Se,{className:"w-6 h-6 text-primary"})}),e.jsx(I,{className:"text-2xl font-bold",children:"FaceAttend"}),e.jsx(ze,{children:"Modern classroom attendance system for educators"})]}),e.jsx(w,{children:e.jsxs(xa,{defaultValue:"signin",className:"w-full",children:[e.jsxs($s,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ae,{value:"signin",className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4"}),"Sign In"]}),e.jsxs(Ae,{value:"signup",className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Sign Up"]})]}),e.jsx(Ee,{value:"signin",children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"signin-email",children:"Email"}),e.jsx(L,{id:"signin-email",type:"email",placeholder:"teacher@school.edu",value:s,onChange:C=>t(C.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"signin-password",children:"Password"}),e.jsx(L,{id:"signin-password",type:"password",value:a,onChange:C=>r(C.target.value),required:!0})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:l,children:l?"Signing In...":"Sign In"})]})}),e.jsx(Ee,{value:"signup",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"signup-name",children:"Full Name"}),e.jsx(L,{id:"signup-name",type:"text",placeholder:"John Smith",value:n,onChange:C=>o(C.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"signup-email",children:"Email"}),e.jsx(L,{id:"signup-email",type:"email",placeholder:"teacher@school.edu",value:s,onChange:C=>t(C.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"signup-password",children:"Password"}),e.jsx(L,{id:"signup-password",type:"password",value:a,onChange:C=>r(C.target.value),required:!0})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:l,children:l?"Creating Account...":"Create Account"})]})})]})})]})})},fa=()=>{const s=bt();return i.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},ga=new yt,pa=()=>e.jsx(wt,{client:ga,children:e.jsx(qt,{children:e.jsxs($t,{children:[e.jsx(Mt,{}),e.jsx(zt,{}),e.jsx(Bt,{}),e.jsx(St,{children:e.jsxs(Ct,{children:[e.jsx(se,{path:"/",element:e.jsx(Xt,{})}),e.jsx(se,{path:"/auth",element:e.jsx(ha,{})}),e.jsx(se,{path:"/scan/:classId",element:e.jsx(ia,{})}),e.jsx(se,{path:"/results/:classId",element:e.jsx(oa,{})}),e.jsx(se,{path:"/class/:classId",element:e.jsx(ma,{})}),e.jsx(se,{path:"/enroll/:classId",element:e.jsx(ua,{})}),e.jsx(se,{path:"*",element:e.jsx(fa,{})})]})})]})})});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("FaceAttend SW registered: ",s)}).catch(s=>{console.log("FaceAttend SW registration failed: ",s)})});Tt(document.getElementById("root")).render(e.jsx(pa,{}));
